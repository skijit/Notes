Norway Wkshp Notes
============
- [info](https://www.derivative.ca/Events/2016/NorwayWorkshop/)

## User Interface Basics
- In the Top menu bar, some options of interest:
    - \[WIKI\] - the online help files, documentation, etc.
    - \[FORUM\]
    - \[TUTORIALS\]
    - **Help**
        - **Operator Snippets**
            - Opens in a separate session and has examples of how each operator works
        - **Python Help**
        - **Download Offline Help**  (could be useful)
- There's a green flag in the upper-right corner which lets you update your build (when one is available)
- Spacebar pauses the playbar/transport
- Also a power bar in the upper tool menu, which can pause things.  
    This should usually be on.
- Palette Browser
    - Left side
    - Examples of prebuilt modules
    - Use as a learning aid or integrate into your project
    - You can rename operators (just type into the bottom line) and then drag them into 'My Components' in the upper half of the Palette Browswer to save them for later reuse.
    - You can easily toggle it open/close
- Network Editor
    - Left button lets you drag/pan around
    - `h`: centers everything.  this is useful in a big network.
    - zooming: middle mouse button.  on a trackpad, just move two fingers up and down.
        - keep your operators the normal size, and then zoom if you want to understand it better.
    - you can select a single operator then press `shift-h` and it will 'home' just on to that operator
        - to 'home' on multiple nodes, use shift-click to select multiple, then `shift-h` 
    - box selection of multiple:
        - right-click and drag
        - **TODO** This is really useful, but it doesn't seem to work on the trackpad.  NEED TO FIGURE OUT HOW TO WORK THIS!
    - Right-click -> Reset node size: resizes everything back to normal
    - `p` toggles the parameter window, which shows data for the currently selected operator
        - parameters sometimes have multiple pages
        - bullseye will show you only the parameters that have changed from their default.
            - Useful when you're first going through somebody's network
            - All of these parameters are animatable, can be expression driven, etc.            
- Operators
    - Different families have different colors
    - Double-click to see menu of Operators
        - In upper right corner, you can select 'Basic' or 'All' depending on how much you want to see
    - Operator menu has a little search box / filter at the top
- Patching mechanics
    - To delete a cord, create a new cord from the output and let it go nowhere
    - Right-click on a patch cord and you can:
        - disconnect
        - insert operator (in the middle)
        - etc.
    - Only lets you connect to appropriate family-types of operators
        - Although there are converters available...
    - You can right-click on an outlet and you'll get the operator menu.  When you select an operator, it will be connected to that outlet.
    - If you drag one cord onto another, it will replace it
    - **Dotted line**
        - not a patch cord, but lets one operator send some type of data to another
            - e.g. for purposes of animation, etc.
- Operator families:
    - **SOP**: Surface Operator for 3D Graphics
    - **CHOP**: Channel operators: motion, audio, animation, and control signals
    - **TOP**: Texture operators - All 2D image operations
    - **DAT**: Capture and representation of data as tables, objects, etc.
    - **MAT**: Material operators: materials and shaders.
    - **COMP**: Components - Typically a subnetwork / module.  Components contain other operators.
        - Object components (3D objects)
        - Panel components (2D UI gadgets)
        - Each component has a path
    - Each family has "generator" operators which take no input and "filter" operators which take 1 or more input.
    - Many operators have parameters that are references to operators in other families
        - Links: dashed line between nodes that represents other data flow between nodes.
            - [Examples](https://www.derivative.ca/wiki088/index.php?title=Link)
        - Exporting: Flows numeric data from a CHOP to other operators.
- Comparing TD against other graphics packages:
    - Has to run in real-time.  
    - This introduces interesting design constraints

## Common TOPS : Movie File In
- When you save, it automatically appends a version number
- `tab` gets you to operator menu
- movies and still images both use `Movie File In` from the TOP menu
- for simpler pathing (ie using relative paths), you should put media assets underneath the project folder
- `Movie File In`
    - Speed attribute lets you vary playback.
        - 1 = normal playback, 2 = double speed, -1 = playback in reverse
        - Not all codecs will support playing back in reverse.
            - H264 is no good.
            - Animation codecs, Photo JPEG are all good at playing backwards.
            - Half Q, Half Q with alpha: good for 4K stuff
            - Always consider what you're trying to accomplish and then select the appropriate codec.
            - If you click the `?` button in the upper left of the parameter window, it takes you to the wiki for that operator.  
                - You can see the file types that are supported.
                - Remember the difference between file type (container) and codec, though
                - In general, any codec supported by VLC should be supported by TD
    - You can set a start point with the cue point parameter.  
        - Then clicking the pulse button will jump that that cue point.
        - You can change the units from percentage, to seconds, to frames, to index
    - To get diagnostic info:
        - Add the `info` CHOP, then in its parameter window, drop the `Movie File In` onto the Operator parameter.
        - Then you'll get a running diagnostic output of all the values, which you can filter.
    - If you notice the frame is a fraction, that is bc TD is running at 60Hz, whereas the movie probably has a framerate less than 30.
    - parameter interpolate frames does an automatic blend, if you want to slow down, but without the steppy motion
    - trim parameters lets you specify sections (start/end) of a movie to play
    - If you point it to a folder of photos, it will do a slideshow at whatever sample rate you specify
    - Individual parms can take a value, an expression, or a reference to another parameter
        - To reference another parameter, right-click on the source parameter and select 'copy parameter' then in the destination parameter, right-click and select 'paste parameter reference'.  The value in there will be python code.
        - you can toggle between expressions and constant values
        - you can reference these parameters across chops and that's when you get the dotted line on the design surface.
    - The Tune page gives you all sorts of low-level optimizations for playback.
- There's a global preference where you can change the resolution multiplier on each TOP
- You can right-click on top of all the operators and choose 'select default' and it will undo all your changes.
- Middle mouse click on any operator and you'll get some other diagnostic info
    - If the middle mouse button is not working, you can get the operator diagnostic info by clicking on the 'i' button in the parameter window, in the upper left
    - **TODO** figure out how to do this with the touchpad
    - it will show you how much GPU memory you have available and how much the current is showing

## Other Common TOPS
- `Constant` TOP just makes a texture that is a single color
    - default size is 256x256
- `over` TOP lets you overlay two images
    - For compositing, be sure t set the PreFit Overlay to 'Native Resolution'
    - You can translate, scale, rotate one image over the other 
- `text` TOP creates a texture with some kind of text in it
    - You can select the fonts or bundle your own with it
    - Has support for unicode, but requires a python patch
- If you right-click on the operator and select 'View', you can view it in native resolution
- if you click on the bottom right corner for any tops, it will place that output into the background of the design surface
    - you can do this for multiple operators at the same time and its a good way to A/B test things
- Operator color coding
    - dark operators: generators
    - lighter operators: filters
- `ramp` top
    - specify any kind and with any colors
    - lets you choose any number of colors: you have to select each one on the top swatch
- the `constant` CHOP (not the TOP) lets you create a channel of a value
    - you can input a `constant` CHOP into a `speed` chop.  
    - the `speed` is like a counter, whose speed is dependent on it's input
    - the `null` CHOP is for creating a copy of a value- you put it at the end of your chain- and then you can export it.
        - select view on the `null` CHOP and then you can drag it onto the value of a parameter you want to animate.
- the `composite` type has any number of combine operators (like `jit.op`)
- 1280 x 720 (aka 720p) is the max non-commercial license resolution
- in the operators that have multi-inputs, you can change the order of the inputs in the parameter window
- `select` TOP: 
    - this is a no-cost operation where you refer to another TOP.
    - this is useful so that your network doesn't get too congested.
    - just drag the TOP you want to select into the select's TOP parameter in the parameter window
    - will produce a dotted line between source and target
        - you can remove the dotted lines by clicking 'x'
- `cross` TOP:
    - cross fade between two different video sources
    - cross parameter determines fade level (value should be between 0 and 1)
- You can switch inputs (e.g. if an operator has 2 inputs) when you click one and drag it to the Other
- You can turn off individual operators visuals, there's a button in the upper-left corner
- Bottom right corner of an operator can set it as 'Active' at which point you can interact with it:
    - drag, zoom, home it, right-click for options, etc.
    - it will keep the operator in place though while active
    - keyboard shortcut (after selecting) is 'A'
- `Blur` TOP
- `Luma Blur`
    - Takes a ramp TOP as input, as well as a movie.
    - The ramp should be black/white gradient
    - In the ramp regions where it is black, you set a blur value for 1 and in the ramp regions where it is white, you set another blur value
- `Switch` TOP
    - Takes any number of inputs
    - Index parameter lets you switch between those inputs
    - You can also blend between indexes (like a multi-crossfade)
- `Mouse In` CHOP - captures mouse movements
- `Math` CHOP - can scale/map from one range to another
    - When you use it like this, you will often connect that to a `Limit` CHOP to put a hard limit on the TO range's upper scale
- `Noise` TOP
    - set types
    - animate
- `Video Device In` TOP
    - Any webcam or capture card video input
- `Photoshop In` TOP
    - They get the active document from Photoshop
- `Kinect sensor` TOP
    - Brings in all the kinect sensor data
    - You need to install the SDK
    - Works for version 1 and 2
- `Circle` TOP
- `Rectangle` TOP

## SOPS
- If you create a `TORUS` SOP, then you might want to click the 'Activate' button (or 'a') to interact with it, such as to Tumble the geometry around.
- You have a bunch of different menu options when you right-click on it.  
    - Toggle Wireframe mode 'w'
    - Display Options ('p'): gives you a custom menu for interacting with the model.
        - You can view points, normals, coordinates, etc
- SOP parameters
    - To clearly see the different types of primitives and rows/columns, set the model to wireframe and then experiment
    - Mesh and Polygons Primitive types are fast for realtime
    - Other options include Nurbs and Bezier... but these can be much heavier on the CPU, especially if you animate.
- `Merge` SOP lets you put two models in a group, and then act on them together
- `Transform` SOP lets you manipulate the model's scale, positioning, orientation.
    - This can apply to the individual model or the merged group depending on who it is connected to.
- 2 Paths to 3d Geometries:
    - Import: Common file format to import a model into TD: FBX
    - Generate Procedurally (via SOP Generator): For simpler particle emitters or masks, you might as well just create them procedurally
- SOP geometries (whether procedural or imported models) are calculated on the CPU
    - Exacerbated when you animate things
    - In the info pop up, you should check the CPU cook time in ms
    - 60Hz means you only have 16ms
    - Consider this for when you try to realtime animate a 3d model with tons of geometry
- `Grid` SOP is what you might use to texture with a movie and move around in 3D space
- `Noise` SOP: You can input a 3d geometry and it will apply noise to each point, deforming it
    - You can also apply noise the colors, point normals, and other properties
- Normals is the angle the given vertex is facing, so this is a key input to the lighting engine
    - `Noise` doesn't change the normals.
    - If you want to re-compute the normals, use the `Attribute Create` SOP
        - this also will recreate tangents... if you know what those are... 
- `Group` SOP is a filter that will let you define a subgroup of points in a geometry.
    - Once you given a group a name, you can take other filter SOP's to target just that group.  EG the `Transform` SOP.
- `Particle` SOP will animate over a 3d object's points.
    - You control how quickly it walks across them, how long the particles live, and other parameters, like where they go

## COMPS
- `Base` Comp
    - Creates a subnetwork
    - You give it a name (bottom of the node) and this name will be displayed in the browser bar
    - You can use the browser bar to navigate
    - shortcuts (while the comp is selected): 
        - 'i' takes you into the comp ( you can also double click or press 'enter')
        - 'u' takes you up out of the comp
        - zoomable ui: If you select it, you can zoom into/out of it, and it will eventually snap you in or out
    - there's also a 'root' button next to the browser bar.
        - this will show you the project setup with other stuff
- Use the `In` and `Out` TOP/CHOP/etc for inlets and outlets
- in the Pane controls, you can create multiple workspaces and then work at different levels
- You can retroactively create a comp by multiselecting and context-clicking on 'collapse'
- You can save a component as a separate .tox file
    - Typically this is how you send examples for the forums, etc.
    - You can also drag/drop a tox file into the network editor
    - You can specify that a component always loads from a separate tox file (like if you get it from github)
        - It will only reload if you re-init the network
- There are bunch of different types of Comps:
    - 3d objects
    - Panels
    - Other
- Panel COMP types helps you create user interface controls
    - Button, Slider, etc.
- Buttons have different modes including *momentary* and *toggle*
- Components have inputs on top and bottom: this is for parenting/hierarchy
- `Container` COMP 
    - good for creating a UI panel which aggregates controls
    - There are 2 ways to connect individual CHOP controls to a `container` CHOP:
    - Using the hiearchy (top/bottom outlets):
        - connect it's bottom to the tops of some UI COMP's (button, slider, etc.)
        - You might need to change the individual control elements Layout properties in it's parameter window
        - You will right click onthe Container and press view.  Then it will open it up in a floating window which you can interact with.
    - Embed controls inside the container
        - You can put all your components inside a container
        - You might want to `merge` the values and the send them to the `out` of the COMP
- There are some other 3d components which are needed to render a scene:
    - `geometry`, `light`, `camera`, etc.
    - these would automatically connect to a `render` TOP

## CHOPS
- Uses of CHOPS
    - Getting Data from Devices
        - MIDI
        - keyboard
        - kinect
        - Leap
        - DMX
        - serial
        - etc.
    - Controlling Devices
        - serial
        - OSC
        - MIDI
        - DMX
        - Laser
        - etc.
    - Time based Animation of Geometries
        - Smoothing noisy signals
        - normalizing data
        - processing motion
        - controlling movie-playback
        - control image effects and 3d shapes
        - Timing events, state machines, counting
        - procedural animation of geometric shapes
            - lfo
            - loops
            - beats
    - audio
        - mixing and effects
        - files and live audio streams
    - avoiding doing things with python or C++
- [Channel](https://www.derivative.ca/wiki088/index.php?title=Channel): aka samples.  Like a signal, it's a sequence of numbers that can represent motion, control signals, MIDI, audio, color maps, rolloff curves or lookup tables.
        - A CHOP outputs one or more channels
        - The group of one or more channels created by a CHOP is called a Clip. 
        - A clip is what a CHOP outputs.
- Each channel is one array of raw samples, which is simply a list of numbers.
- Each channel of a CHOP has a channel name that can be set by the user.
- Channels can also be exported to a parameter of any operator, overriding that parameter's value.
- CHOP data flows at the frame rate
- A CHOP contains:
    - Set of channels
        - The various sequences of data (aka samples)
    - Control Parameters
        - Defines the data and data channels
        - Usually constants, but they can be time-dependent expressions
        - 3 parameter units:
            1. Samples (indexes)
            2. Frames
            3. Seconds
        - Each sample number (0 indexed) corresponds to a frame number (based on fps setting) and a moment in time
        - You select the units in the parameter menu to the right of the parameter value
    - Sample Rate
        - This is used if the CHOP contains time-dependent motion or audio data
    - Various on/off flags (displayed in the upper-left corner of the object)
        - Display flag: marks the CHOP to be displayed in the CHOP viewer
        - Export flag: toggles channel exports on / off
        - Lock flag
        - ByPass flag
    - Start/End Interval
        - Offset indices for start and end- shared by all channels in a CHOP
- [Sample vs Frames](https://www.derivative.ca/wiki088/index.php?title=CHOP)
    - Frame refers to the timeline, which is expressed in time (sec) and/or frames
    - Time_Sec = (Frame-1)/FPS
    - Sample index may have no relation to time or frame
        - E.G. when a CHOP is used as a lookup table
    - When the samples are time oriented, the start/end interval is determined by sample rate
        - Sample Rate (samples/sec) can be related to FPS as Samples per Frame
- Channel Data
![channel info](/resources/images/programming/ChannelsInfo2.gif)
    - The horizontal axis is called the i-axis or the sample index-axis.
    - The vertical axis is called the v-axis or the value-axis.
    - A sample index is a point along the i-axis,denoted by i.
    - A value is a point along the v-axis, denoted by v.
    - A sample is an index-value pair (i,v). i.e. the value of a channel at a certain sample index.
    - A sample is made of a sample index and a sample value.
    - An interval is an index range, which goes from a start index to an end index.
    - A value range goes from a start value to an end value.
    - The index duration is the end index minus the start index + 1.
    - CHOP data channels are arrays of raw samples, in 32-bit floating point format, all computations are done at 64 bits, and parameters are stored as 64 bits.
    - CHOPs can be evaluated at integer and non-integer indexes.
    - Frame is used when the index corresponds to time.
    - When speaking of animation frames, you can refer to start frame, end frame and frame range.
    - a "Channel Index" is the channel number of a CHOP, 0 being the first channel.

- **Example 1**:
    - (notes are based on file: CHOPsDATS.15.toe)
    - `Mouse In` CHOP -> `Math` CHOP with *Combine Channels* set to *Length* -> `Filter` CHOP to smooth data -> `Slope` CHOP to only record directional changes -> `Logic` CHOP to translate into 0 or 1 *(and possibly only react on larger changes?)* -> `Trigger` CHOP to create an envelope -> `Null` CHOP to export data to two `Cross` TOPs -> `CHOPTo` *(not sure what this is for)*
    - In making sense of these operators, don't hesitate to find their corresponding operator snippet from **Help->Operator Snippets**
    - `Math` [CHOP](http://www.derivative.ca/wiki088/index.php?title=Math_CHOP):
        - Lets you operate on multiple channels from a CHOP (combining them in some fashion), or multiple channels from multiple CHOPS
        - You have slots pre and post channel/CHOP combining to let you manipulate the data
        - You can also do range scaling very easily (has a dedicated page)
        - This example combines the channels using the *Length* method, which treats each channel combination as a vector, which it then uses to calculate the distance. 
    - `Filter` [CHOP](http://www.derivative.ca/wiki088/index.php?title=Filter_CHOP):
        - The Filter CHOP smooths or sharpens the input channels. 
        - It filters by combining each sample and a range of its neighbor samples (determined by Filter Width parameter) to set the new value of that sample.
        - There are a bunch of filter types, and each one prescribes a weighting factors for the various neighbors.
        - It can operate on motion and, theoretically, sound but there are other CHOP's that are better for sound (e.g. bandpass, parameteric filter, etc.)  
    - `Slope` [CHOP](http://www.derivative.ca/wiki088/index.php?title=Slope_CHOP):
        - The slope is the first derivative of the channel curve. 
        - The second and third derivatives can also be calculated
        - Often used in combination with a `Speed` CHOP such that you calculate the slope of some object's motion, do some addtional processing on it, then use the `Speed` CHOP to calculate the new position.  
            - When you do this, you probably need to capture the original position in a `Constant` CHOP and then feed this into your calculation, as an offset.
    - `Speed` [CHOP](http://www.derivative.ca/wiki088/index.php?title=Speed_CHOP): 
        - You feed it a value to increment by, which it interprets as a distance per second.  Then it updates current value by that amount / FPS.
    - `Logic` [CHOP](http://www.derivative.ca/wiki088/index.php?title=Logic_CHOP):
        - The Logic CHOP first converts channels of all its input CHOPs into binary (0 = off, 1 = on) channels and then combines the channels using a variety of logic operations.
        - *Convert Input* parameter determines the method of converting input to binary.   
            - *Off When Zero*: Returns a logical 0 when channel value is zero;  Non zero values return 1.
            - *Off When Zero or Less*: Returns a logical 0 when a channel value is zero or less; and 1 when values are positive.
            - *Off When Outside Bounds*: Returns 0 when channel value is outside the bounds set by the Bounds parameter.
            - *On When Value Changed*: Returns 1 when the channel value changes.
            - *On When Channel Name Changed*: Returns 1 when the channel name changes.
        - *Bounds* Parameter: sets upper and lower bounds when *Convert Input* setting is *Off When Outside Bounds*
    - `Trigger` [CHOP](http://www.derivative.ca/wiki088/index.php?title=Trigger_CHOP)
        - The Trigger CHOP starts an audio-style attack/decay/sustain/release (ADSR) envelope to all trigger pulses in the input channels.
        - A trigger point occurs whenever the first input's channel increases across the trigger threshold value.
            - In this case, we were saying the threshold is 0
        - Outputs a value between 0 and 1
        - The envelope consists of six major sections: delay, attack, peak, decay, sustain and release.
    - `Cross` [CHOP](http://www.derivative.ca/wiki088/index.php?title=Cross_CHOP)
        - The Cross CHOP is a multi input OP that blends between 2 inputs at a time
            - A value of 0 will select the first input, 1 will select the second input, 2 will select the third and so on
            - Using in between values will blend the 2 closest inputs
        - This is similar to a `Switch` CHOP however the Cross CHOP allows for interpolation between the inputs.
    - `CHOP to TOP` [link](http://www.derivative.ca/wiki088/index.php?title=CHOP_to_TOP):
        - Converts CHOP channel data into an image.
        - The dimensions of the image are dependent on the specified parameter values.  In this case, the size if 1x1, but it only looks like this if you set it to *Native Resolution*
        - Refers to the correspondin CHOP by reference, not by a typical network connection.
    - `Composite` [TOP](http://www.derivative.ca/wiki088/index.php?title=Composite_TOP)
        - This is like `jit.op`: you specify the operation on how to combine the images.
        - The parameter *Fixed Layer* defines which of the (possibly multiple) inputs is fixed.
            - There can be only one fixed layer.
            - All the other inputs are overlays.
            - You can define how you want to fit your overlay over the fixed layer with the parameter *Pre-fit Overlay*
    - `Trail` CHOP: lets you graph channels over time
- When you center-click on a CHOP, it will show you the start/end range in frames, samples, and seconds
    - Typically the length is a fraction of a second, but in the case of `Trail` it defaults to around 4sec
    - It will also tell you the sample rate (default = global FPS)
- The frame number is relative to the timeline at the bottom, which will loop/reset after the specified number of frames
- `Noise` CHOP
    - This can be used as an audio CHOP- and it begins to demonstrate how the FPS and audio rate differ
    - Sample range defaults to 10sec or 600 frames
    - You can change the start/end range from the *Channel* parameter page:
        - Sample rate parameter defaults to an expression pointing to the FPS
    - When you *activate* the CHOP, you can right-click and view it differently:
        - You can view each sample (Dots per Sample)
        - You can use your middle mouse button to zoom around it and change the scaling.
    - Noise pattern is deterministic, based on the seed.  
        - So, you can recreate the same noise if you give it the same noise.
        - Alternately, you could set it via some expression, and it will be more random.
- `Audio File In` CHOP
    - Setting the *Lock* flag will freeze your data so you don't see it constantly scrolling around.
    - The start/end range will be relative to the timeline, as always.
    - Even though the SR will be 44.1kHz, your audio range may span multiple Frames (whose rate is of course, much slower)
    - You can downsample the audio, depending on what you want to do with it, with the `Resample` CHOP
        - Seems to have a lowpass filtering effect
- `Lookup` CHOP seems good for wavetable stuff
- CHOPS and Container Components
    - Even though you might not have any controls, you can have a bunch of generators, and then merge them together as a single output
- `Keyboard In` CHOP lets you capture triggers from different keyboard buttons (ie QWERTY)
- `Fan` CHOP lets you combine multiple logical channels into a single integer.
    - You can *Fan In* which will combine multiple channels to one, or *Fan Out* which will expand the single to multichannel
    - Non-destructive:  I guess that's the difference between it and `Math` 

## Intro to DATs
- DAT's are Good For: 
    - Text
    - tables
    - GLSL
    - JSON
    - XML
    - Python Scripts
    - You can send this to a `Text` TOP to generate an image of the text
    - Getting / Sending messages to Devices
        - They come in as text strings
        - MIDI, OSC, serial, etc.
    - Protocols from other software
        - TCP/IP, OSC, WebSockets, http
    - Defines and runs the TD interface!
        - To see how each piece works, hover over it and press F10
    - Give you information about your machine
        - `Monitors` DAT lets you see what monitors are currently connected
- `Text` Dat: where you can just add some text.  
- Certain nodes, like a `Ramp` TOP will have a little button in the bottom right corner which indicates its hiding an associated DAT
    - Click to see/edit the underlying data
    - This is called 'Docking to...' and you can do this for any DAT.
        - Just right-click on the DAT 'Dock To...' and drag it to the associated node
- `Web` DAT will let you capture the response to an HTTP call
- MAT shaders often have associated DAT's driving them.
- `Select` DAT will let us parse and chop up `Table` DATs
- `Evaluate` DAT lets you run small chunks of python expressions
- `Merge` DAT will let you overlay/concat/interleave 2 different DATs together
- `Sort` DAT will let you sort the data in a `Table` DAT
- You can convert the data in SOPs into a DAT and manipulate it

    
        
